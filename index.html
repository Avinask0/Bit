<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIT-RUPEE - INR Stablecoin on Polygon</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .wallet-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #48bb78;
        }

        .wallet-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .address {
            font-family: monospace;
            background: #f7fafc;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stat-label {
            color: #718096;
            font-size: 0.9em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2d3748;
        }

        .action-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .action-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .action-card h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: #4a5568;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.2s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .info-text {
            background: #edf2f7;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #4a5568;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            margin-top: 15px;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .action-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸª™ BIT-RUPEE</h1>
            <p>INR-Pegged Stablecoin on Polygon â€¢ Powered by Aave</p>
        </div>

        <div class="wallet-section">
            <div class="wallet-info">
                <div>
                    <button id="connectBtn" class="btn">Connect Wallet</button>
                </div>
                <div id="walletAddress" class="address" style="display:none;"></div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Your BINR Balance</div>
                <div class="stat-value" id="binrBalance">0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Your USDC Balance</div>
                <div class="stat-value" id="usdcBalance">0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">INR/USD Rate</div>
                <div class="stat-value" id="inrRate">â‚¹0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Value Locked</div>
                <div class="stat-value" id="tvl">$0.00</div>
            </div>
        </div>

        <div class="action-cards">
            <div class="action-card">
                <h2>ðŸª™ Mint BINR</h2>
                <div class="info-text">
                    Deposit USDC to mint BINR tokens at the current INR rate
                </div>
                <div class="input-group">
                    <label>USDC Amount</label>
                    <input type="number" id="mintAmount" placeholder="0.00" step="0.01" min="1">
                </div>
                <div class="info-text" id="mintPreview">
                    You will receive: ~0 BINR
                </div>
                <button class="btn" id="approveUsdcBtn" style="margin-right: 10px;">Approve USDC</button>
                <button class="btn btn-secondary" id="mintBtn">Mint BINR</button>
                <div class="loading" id="mintLoading">Processing transaction...</div>
                <div class="error" id="mintError"></div>
                <div class="success" id="mintSuccess"></div>
            </div>

            <div class="action-card">
                <h2>ðŸ”¥ Burn BINR</h2>
                <div class="info-text">
                    Burn BINR tokens to receive USDC (includes yield!)
                </div>
                <div class="input-group">
                    <label>BINR Amount</label>
                    <input type="number" id="burnAmount" placeholder="0.00" step="0.01" min="1">
                </div>
                <div class="info-text" id="burnPreview">
                    You will receive: ~0 USDC
                </div>
                <button class="btn btn-secondary" id="burnBtn">Burn BINR</button>
                <div class="loading" id="burnLoading">Processing transaction...</div>
                <div class="error" id="burnError"></div>
                <div class="success" id="burnSuccess"></div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - UPDATE THESE WITH YOUR ACTUAL ADDRESSES
        const CONFIG = {
            BINR_ADDRESS: '0x7Ab8c3947590908FDcfC6321fFfD240e1B81f2B5',
            USDC_ADDRESS: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174', // Polygon USDC
            CHAIN_ID: 137, // Polygon Mainnet
            CHAIN_NAME: 'Polygon Mainnet'
        };

        const BINR_ABI = [
            "function mint(uint256 usdcAmount, uint256 minTokensOut) external",
            "function burn(uint256 tokenAmount, uint256 minUsdcOut) external",
            "function balanceOf(address account) external view returns (uint256)",
            "function getLatestPrice() external view returns (uint256)",
            "function getInrPerUsd() external view returns (uint256)",
            "function pricePerTokenInUsdc() external view returns (uint256)",
            "function getTotalValue() external view returns (uint256)",
            "function mintFeeBps() external view returns (uint256)",
            "function burnFeeBps() external view returns (uint256)"
        ];

        const ERC20_ABI = [
            "function balanceOf(address account) external view returns (uint256)",
            "function approve(address spender, uint256 amount) external returns (bool)",
            "function allowance(address owner, address spender) external view returns (uint256)"
        ];

        let provider, signer, binrContract, usdcContract, userAddress;

        // Connect Wallet
        document.getElementById('connectBtn').addEventListener('click', async () => {
            try {
                if (typeof window.ethereum === 'undefined') {
                    alert('Please install MetaMask!');
                    return;
                }

                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.BrowserProvider(window.ethereum);
                
                const network = await provider.getNetwork();
                if (Number(network.chainId) !== CONFIG.CHAIN_ID) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x89' }], // 137 in hex
                        });
                    } catch (error) {
                        alert('Please switch to Polygon Mainnet in MetaMask');
                        return;
                    }
                }

                signer = await provider.getSigner();
                userAddress = await signer.getAddress();

                binrContract = new ethers.Contract(CONFIG.BINR_ADDRESS, BINR_ABI, signer);
                usdcContract = new ethers.Contract(CONFIG.USDC_ADDRESS, ERC20_ABI, signer);

                document.getElementById('connectBtn').textContent = 'Connected';
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('walletAddress').textContent = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
                document.getElementById('walletAddress').style.display = 'block';

                await updateBalances();
                startAutoRefresh();
            } catch (error) {
                console.error('Connection error:', error);
                alert('Failed to connect wallet');
            }
        });

        // Update Balances
        async function updateBalances() {
            if (!binrContract || !userAddress) return;

            try {
                const [binrBal, usdcBal, inrRate, tvl] = await Promise.all([
                    binrContract.balanceOf(userAddress),
                    usdcContract.balanceOf(userAddress),
                    binrContract.getInrPerUsd(),
                    binrContract.getTotalValue()
                ]);

                document.getElementById('binrBalance').textContent = 
                    parseFloat(ethers.formatUnits(binrBal, 18)).toFixed(2);
                document.getElementById('usdcBalance').textContent = 
                    parseFloat(ethers.formatUnits(usdcBal, 6)).toFixed(2);
                document.getElementById('inrRate').textContent = 
                    'â‚¹' + parseFloat(ethers.formatUnits(inrRate, 8)).toFixed(2);
                document.getElementById('tvl').textContent = 
                    '$' + parseFloat(ethers.formatUnits(tvl, 6)).toFixed(2);
            } catch (error) {
                console.error('Error updating balances:', error);
            }
        }

        // Mint Preview
        document.getElementById('mintAmount').addEventListener('input', async (e) => {
            const amount = e.target.value;
            if (!amount || !binrContract) {
                document.getElementById('mintPreview').textContent = 'You will receive: ~0 BINR';
                return;
            }

            try {
                const usdcAmount = ethers.parseUnits(amount, 6);
                const [usdPerInr, mintFee] = await Promise.all([
                    binrContract.getLatestPrice(),
                    binrContract.mintFeeBps()
                ]);

                const fee = (usdcAmount * mintFee) / 10000n;
                const netUsdc = usdcAmount - fee;
                const inrValue = (netUsdc * ethers.parseUnits('1', 8)) / usdPerInr;
                const tokensToMint = inrValue * ethers.parseUnits('1', 12);

                document.getElementById('mintPreview').textContent = 
                    `You will receive: ~${parseFloat(ethers.formatUnits(tokensToMint, 18)).toFixed(2)} BINR`;
            } catch (error) {
                console.error('Preview error:', error);
            }
        });

        // Burn Preview
        document.getElementById('burnAmount').addEventListener('input', async (e) => {
            const amount = e.target.value;
            if (!amount || !binrContract) {
                document.getElementById('burnPreview').textContent = 'You will receive: ~0 USDC';
                return;
            }

            try {
                const tokenAmount = ethers.parseUnits(amount, 18);
                const [pricePerToken, burnFee] = await Promise.all([
                    binrContract.pricePerTokenInUsdc(),
                    binrContract.burnFeeBps()
                ]);

                const usdcAmount = (tokenAmount * pricePerToken) / (ethers.parseUnits('1', 18) * ethers.parseUnits('1', 12));
                const fee = (usdcAmount * burnFee) / 10000n;
                const netUsdc = usdcAmount - fee;

                document.getElementById('burnPreview').textContent = 
                    `You will receive: ~${parseFloat(ethers.formatUnits(netUsdc, 6)).toFixed(2)} USDC`;
            } catch (error) {
                console.error('Preview error:', error);
            }
        });

        // Approve USDC
        document.getElementById('approveUsdcBtn').addEventListener('click', async () => {
            const amount = document.getElementById('mintAmount').value;
            if (!amount) {
                showError('mintError', 'Please enter an amount');
                return;
            }

            try {
                showLoading('mintLoading', true);
                const usdcAmount = ethers.parseUnits(amount, 6);
                const tx = await usdcContract.approve(CONFIG.BINR_ADDRESS, usdcAmount);
                await tx.wait();
                showSuccess('mintSuccess', 'USDC approved successfully!');
            } catch (error) {
                showError('mintError', error.message);
            } finally {
                showLoading('mintLoading', false);
            }
        });

        // Mint BINR
        document.getElementById('mintBtn').addEventListener('click', async () => {
            const amount = document.getElementById('mintAmount').value;
            if (!amount) {
                showError('mintError', 'Please enter an amount');
                return;
            }

            try {
                showLoading('mintLoading', true);
                const usdcAmount = ethers.parseUnits(amount, 6);
                const minTokensOut = 0; // Set slippage tolerance if needed
                
                const tx = await binrContract.mint(usdcAmount, minTokensOut);
                await tx.wait();
                
                showSuccess('mintSuccess', 'BINR minted successfully!');
                await updateBalances();
                document.getElementById('mintAmount').value = '';
            } catch (error) {
                showError('mintError', error.message);
            } finally {
                showLoading('mintLoading', false);
            }
        });

        // Burn BINR
        document.getElementById('burnBtn').addEventListener('click', async () => {
            const amount = document.getElementById('burnAmount').value;
            if (!amount) {
                showError('burnError', 'Please enter an amount');
                return;
            }

            try {
                showLoading('burnLoading', true);
                const tokenAmount = ethers.parseUnits(amount, 18);
                const minUsdcOut = 0; // Set slippage tolerance if needed
                
                const tx = await binrContract.burn(tokenAmount, minUsdcOut);
                await tx.wait();
                
                showSuccess('burnSuccess', 'BINR burned successfully!');
                await updateBalances();
                document.getElementById('burnAmount').value = '';
            } catch (error) {
                showError('burnError', error.message);
            } finally {
                showLoading('burnLoading', false);
            }
        });

        // Helper functions
        function showError(id, message) {
            const el = document.getElementById(id);
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showSuccess(id, message) {
            const el = document.getElementById(id);
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showLoading(id, show) {
            document.getElementById(id).style.display = show ? 'block' : 'none';
        }

        function startAutoRefresh() {
            setInterval(updateBalances, 15000); // Refresh every 15 seconds
        }
    </script>
</body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIT-RUPEE - INR Stablecoin on Polygon</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .wallet-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #48bb78;
        }

        .wallet-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .address {
            font-family: monospace;
            background: #f7fafc;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stat-label {
            color: #718096;
            font-size: 0.9em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2d3748;
        }

        .action-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .action-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .action-card h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: #4a5568;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.2s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .info-text {
            background: #edf2f7;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #4a5568;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            margin-top: 15px;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .action-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸª™ BIT-RUPEE</h1>
            <p>INR-Pegged Stablecoin on Polygon â€¢ Powered by Aave</p>
        </div>

        <div class="wallet-section">
            <div class="wallet-info">
                <div>
                    <button id="connectBtn" class="btn">Connect Wallet</button>
                </div>
                <div id="walletAddress" class="address" style="display:none;"></div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Your BINR Balance</div>
                <div class="stat-value" id="binrBalance">0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Your USDC Balance</div>
                <div class="stat-value" id="usdcBalance">0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">INR/USD Rate</div>
                <div class="stat-value" id="inrRate">â‚¹0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Value Locked</div>
                <div class="stat-value" id="tvl">$0.00</div>
            </div>
        </div>

        <div class="action-cards">
            <div class="action-card">
                <h2>ðŸª™ Mint BINR</h2>
                <div class="info-text">
                    Deposit USDC to mint BINR tokens at the current INR rate
                </div>
                <div class="input-group">
                    <label>USDC Amount</label>
                    <input type="number" id="mintAmount" placeholder="0.00" step="0.01" min="1">
                </div>
                <div class="info-text" id="mintPreview">
                    You will receive: ~0 BINR
                </div>
                <button class="btn" id="approveUsdcBtn" style="margin-right: 10px;">Approve USDC</button>
                <button class="btn btn-secondary" id="mintBtn">Mint BINR</button>
                <div class="loading" id="mintLoading">Processing transaction...</div>
                <div class="error" id="mintError"></div>
                <div class="success" id="mintSuccess"></div>
            </div>

            <div class="action-card">
                <h2>ðŸ”¥ Burn BINR</h2>
                <div class="info-text">
                    Burn BINR tokens to receive USDC (includes yield!)
                </div>
                <div class="input-group">
                    <label>BINR Amount</label>
                    <input type="number" id="burnAmount" placeholder="0.00" step="0.01" min="1">
                </div>
                <div class="info-text" id="burnPreview">
                    You will receive: ~0 USDC
                </div>
                <button class="btn btn-secondary" id="burnBtn">Burn BINR</button>
                <div class="loading" id="burnLoading">Processing transaction...</div>
                <div class="error" id="burnError"></div>
                <div class="success" id="burnSuccess"></div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - UPDATE THESE WITH YOUR ACTUAL ADDRESSES
        const CONFIG = {
            BINR_ADDRESS: '0x7Ab8c3947590908FDcfC6321fFfD240e1B81f2B5',
            USDC_ADDRESS: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174', // Polygon USDC
            CHAIN_ID: 137, // Polygon Mainnet
            CHAIN_NAME: 'Polygon Mainnet'
        };

        const BINR_ABI = [
            "function mint(uint256 usdcAmount, uint256 minTokensOut) external",
            "function burn(uint256 tokenAmount, uint256 minUsdcOut) external",
            "function balanceOf(address account) external view returns (uint256)",
            "function getLatestPrice() external view returns (uint256)",
            "function getInrPerUsd() external view returns (uint256)",
            "function pricePerTokenInUsdc() external view returns (uint256)",
            "function getTotalValue() external view returns (uint256)",
            "function mintFeeBps() external view returns (uint256)",
            "function burnFeeBps() external view returns (uint256)"
        ];

        const ERC20_ABI = [
            "function balanceOf(address account) external view returns (uint256)",
            "function approve(address spender, uint256 amount) external returns (bool)",
            "function allowance(address owner, address spender) external view returns (uint256)"
        ];

        let provider, signer, binrContract, usdcContract, userAddress;

        // Connect Wallet
     document.getElementById('connectBtn').addEventListener('click', async () => {
    try {
        let provider;

        if (typeof window.ethereum !== 'undefined') {
            // Desktop or MetaMask in-app
            provider = new ethers.BrowserProvider(window.ethereum);
            await window.ethereum.request({ method: 'eth_requestAccounts' });
        } else {
            // Mobile browser (no injected wallet)
            const walletConnectProvider = new WalletConnectProvider.default({
                rpc: {
                    137: "https://polygon-rpc.com/"
                },
                chainId: 137,
                qrcode: true
            });
            await walletConnectProvider.enable();
            provider = new ethers.BrowserProvider(walletConnectProvider);
        }

        signer = await provider.getSigner();
        userAddress = await signer.getAddress();

        binrContract = new ethers.Contract(CONFIG.BINR_ADDRESS, BINR_ABI, signer);
        usdcContract = new ethers.Contract(CONFIG.USDC_ADDRESS, ERC20_ABI, signer);

        document.getElementById('connectBtn').textContent = 'Connected';
        document.getElementById('connectBtn').disabled = true;
        document.getElementById('walletAddress').textContent =
            `${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
        document.getElementById('walletAddress').style.display = 'block';

        await updateBalances();
        startAutoRefresh();

    } catch (error) {
        console.error('Connection error:', error);
        alert('Failed to connect wallet');
    }
});

        // Update Balances
        async function updateBalances() {
            if (!binrContract || !userAddress) return;

            try {
                const [binrBal, usdcBal, inrRate, tvl] = await Promise.all([
                    binrContract.balanceOf(userAddress),
                    usdcContract.balanceOf(userAddress),
                    binrContract.getInrPerUsd(),
                    binrContract.getTotalValue()
                ]);

                document.getElementById('binrBalance').textContent = 
                    parseFloat(ethers.formatUnits(binrBal, 18)).toFixed(2);
                document.getElementById('usdcBalance').textContent = 
                    parseFloat(ethers.formatUnits(usdcBal, 6)).toFixed(2);
                document.getElementById('inrRate').textContent = 
                    'â‚¹' + parseFloat(ethers.formatUnits(inrRate, 8)).toFixed(2);
                document.getElementById('tvl').textContent = 
                    '$' + parseFloat(ethers.formatUnits(tvl, 6)).toFixed(2);
            } catch (error) {
                console.error('Error updating balances:', error);
            }
        }

        // Mint Preview
        document.getElementById('mintAmount').addEventListener('input', async (e) => {
            const amount = e.target.value;
            if (!amount || !binrContract) {
                document.getElementById('mintPreview').textContent = 'You will receive: ~0 BINR';
                return;
            }

            try {
                const usdcAmount = ethers.parseUnits(amount, 6);
                const [usdPerInr, mintFee] = await Promise.all([
                    binrContract.getLatestPrice(),
                    binrContract.mintFeeBps()
                ]);

                const fee = (usdcAmount * mintFee) / 10000n;
                const netUsdc = usdcAmount - fee;
                const inrValue = (netUsdc * ethers.parseUnits('1', 8)) / usdPerInr;
                const tokensToMint = inrValue * ethers.parseUnits('1', 12);

                document.getElementById('mintPreview').textContent = 
                    `You will receive: ~${parseFloat(ethers.formatUnits(tokensToMint, 18)).toFixed(2)} BINR`;
            } catch (error) {
                console.error('Preview error:', error);
            }
        });

        // Burn Preview
        document.getElementById('burnAmount').addEventListener('input', async (e) => {
            const amount = e.target.value;
            if (!amount || !binrContract) {
                document.getElementById('burnPreview').textContent = 'You will receive: ~0 USDC';
                return;
            }

            try {
                const tokenAmount = ethers.parseUnits(amount, 18);
                const [pricePerToken, burnFee] = await Promise.all([
                    binrContract.pricePerTokenInUsdc(),
                    binrContract.burnFeeBps()
                ]);

                const usdcAmount = (tokenAmount * pricePerToken) / (ethers.parseUnits('1', 18) * ethers.parseUnits('1', 12));
                const fee = (usdcAmount * burnFee) / 10000n;
                const netUsdc = usdcAmount - fee;

                document.getElementById('burnPreview').textContent = 
                    `You will receive: ~${parseFloat(ethers.formatUnits(netUsdc, 6)).toFixed(2)} USDC`;
            } catch (error) {
                console.error('Preview error:', error);
            }
        });

        // Approve USDC
        document.getElementById('approveUsdcBtn').addEventListener('click', async () => {
            const amount = document.getElementById('mintAmount').value;
            if (!amount) {
                showError('mintError', 'Please enter an amount');
                return;
            }

            try {
                showLoading('mintLoading', true);
                const usdcAmount = ethers.parseUnits(amount, 6);
                const tx = await usdcContract.approve(CONFIG.BINR_ADDRESS, usdcAmount);
                await tx.wait();
                showSuccess('mintSuccess', 'USDC approved successfully!');
            } catch (error) {
                showError('mintError', error.message);
            } finally {
                showLoading('mintLoading', false);
            }
        });

        // Mint BINR
        document.getElementById('mintBtn').addEventListener('click', async () => {
            const amount = document.getElementById('mintAmount').value;
            if (!amount) {
                showError('mintError', 'Please enter an amount');
                return;
            }

            try {
                showLoading('mintLoading', true);
                const usdcAmount = ethers.parseUnits(amount, 6);
                const minTokensOut = 0; // Set slippage tolerance if needed
                
                const tx = await binrContract.mint(usdcAmount, minTokensOut);
                await tx.wait();
                
                showSuccess('mintSuccess', 'BINR minted successfully!');
                await updateBalances();
                document.getElementById('mintAmount').value = '';
            } catch (error) {
                showError('mintError', error.message);
            } finally {
                showLoading('mintLoading', false);
            }
        });

        // Burn BINR
        document.getElementById('burnBtn').addEventListener('click', async () => {
            const amount = document.getElementById('burnAmount').value;
            if (!amount) {
                showError('burnError', 'Please enter an amount');
                return;
            }

            try {
                showLoading('burnLoading', true);
                const tokenAmount = ethers.parseUnits(amount, 18);
                const minUsdcOut = 0; // Set slippage tolerance if needed
                
                const tx = await binrContract.burn(tokenAmount, minUsdcOut);
                await tx.wait();
                
                showSuccess('burnSuccess', 'BINR burned successfully!');
                await updateBalances();
                document.getElementById('burnAmount').value = '';
            } catch (error) {
                showError('burnError', error.message);
            } finally {
                showLoading('burnLoading', false);
            }
        });

        // Helper functions
        function showError(id, message) {
            const el = document.getElementById(id);
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showSuccess(id, message) {
            const el = document.getElementById(id);
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showLoading(id, show) {
            document.getElementById(id).style.display = show ? 'block' : 'none';
        }

        function startAutoRefresh() {
            setInterval(updateBalances, 15000); // Refresh every 15 seconds
        }
    </script>
</body>
</html>

